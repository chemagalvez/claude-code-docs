<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Gesti√≥n de Contexto en Claude Code - Optimizaci√≥n, l√≠mites de tokens y mejores pr√°cticas">
    <title>4. Gesti√≥n de Contexto | Claude Code para macOS</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">ü§ñ</div>
                <span>Claude Code Docs</span>
            </a>
            <div class="nav-controls">
                <select id="page-selector" class="page-selector"></select>
                <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema">üåô</button>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="progress-indicator">
                <span id="progress-indicator">P√°gina 5 de 9</span>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 55.55%"></div>
                </div>
            </div>

            <div class="content-wrapper">
                <h1>Gesti√≥n de Contexto en Claude Code</h1>

                <p>
                    Una de las caracter√≠sticas m√°s poderosas de Claude Code es su capacidad para gestionar contexto de forma inteligente.
                    Entender c√≥mo funciona el contexto y c√≥mo optimizarlo te permitir√° trabajar de forma m√°s eficiente y reducir costos.
                    En esta secci√≥n aprender√°s todo sobre la gesti√≥n de contexto, memoria, l√≠mites de tokens y optimizaci√≥n.
                </p>

                <h2>¬øQu√© es el Contexto en Claude Code?</h2>

                <p>
                    El <strong>contexto</strong> es toda la informaci√≥n que Claude mantiene en memoria durante una conversaci√≥n:
                </p>

                <ul>
                    <li><strong>Historial de la conversaci√≥n:</strong> Todos los mensajes intercambiados</li>
                    <li><strong>Archivos le√≠dos:</strong> Contenido de archivos que has compartido</li>
                    <li><strong>C√≥digo generado:</strong> Todo el c√≥digo creado durante la sesi√≥n</li>
                    <li><strong>Instrucciones del sistema:</strong> Configuraci√≥n y prompts del sistema</li>
                </ul>

                <div class="alert info">
                    <div class="alert-icon">‚ÑπÔ∏è</div>
                    <div class="alert-content">
                        <h4>¬øPor qu√© es importante el contexto?</h4>
                        <p>Un buen manejo del contexto permite a Claude Code mantener coherencia en conversaciones largas,
                        recordar decisiones anteriores y generar c√≥digo m√°s preciso. Sin embargo, el contexto tiene l√≠mites
                        y costos asociados que debes conocer.</p>
                    </div>
                </div>

                <h2>L√≠mites de Tokens por Modelo</h2>

                <p>
                    Cada modelo de Claude tiene diferentes l√≠mites de contexto (ventana de contexto). Entender estos l√≠mites
                    es crucial para optimizar tu uso de Claude Code.
                </p>

                <h3>Ventanas de Contexto de Claude 3</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Modelo</th>
                            <th>Ventana de Contexto</th>
                            <th>Tokens de Entrada</th>
                            <th>Tokens de Salida</th>
                            <th>Uso Recomendado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Claude 3 Opus</strong></td>
                            <td>200,000 tokens</td>
                            <td>~150,000 palabras</td>
                            <td>4,096 tokens</td>
                            <td>Proyectos complejos, an√°lisis profundo</td>
                        </tr>
                        <tr>
                            <td><strong>Claude 3 Sonnet</strong></td>
                            <td>200,000 tokens</td>
                            <td>~150,000 palabras</td>
                            <td>4,096 tokens</td>
                            <td>Uso diario balanceado</td>
                        </tr>
                        <tr>
                            <td><strong>Claude 3 Haiku</strong></td>
                            <td>200,000 tokens</td>
                            <td>~150,000 palabras</td>
                            <td>4,096 tokens</td>
                            <td>Tareas r√°pidas y simples</td>
                        </tr>
                    </tbody>
                </table>

                <div class="alert warning">
                    <div class="alert-icon">‚ö†Ô∏è</div>
                    <div class="alert-content">
                        <h4>Costo por Token</h4>
                        <p>Aunque todos los modelos tienen la misma ventana de contexto, el <strong>costo por token var√≠a</strong>.
                        Opus es m√°s costoso pero m√°s preciso, mientras que Haiku es econ√≥mico pero m√°s simple. Sonnet ofrece el
                        mejor balance precio/rendimiento para la mayor√≠a de los casos.</p>
                    </div>
                </div>

                <h3>C√°lculo de Tokens</h3>

                <p>
                    Entender c√≥mo se calculan los tokens te ayudar√° a estimar el costo de tus conversaciones:
                </p>

                <div class="code-block">
                    <pre><code class="language-bash"># Ver estad√≠sticas de la conversaci√≥n actual
claude-code --stats

# Ver detalles de tokens
claude-code --token-count "Analiza este archivo" archivo.js

# Estimar tokens antes de enviar
claude-code --dry-run "Tu prompt aqu√≠" archivos.js</code></pre>
                </div>

                <h3>Reglas Aproximadas de Tokens</h3>

                <ul>
                    <li>1 token ‚âà 4 caracteres en ingl√©s</li>
                    <li>1 token ‚âà 3/4 de una palabra en ingl√©s</li>
                    <li>100 tokens ‚âà 75 palabras</li>
                    <li>1,000 tokens ‚âà 750 palabras</li>
                    <li>C√≥digo: var√≠a seg√∫n lenguaje, ~1.5 tokens por palabra</li>
                </ul>

                <h2>Uso de .claudeignore</h2>

                <p>
                    El archivo <code>.claudeignore</code> es fundamental para optimizar el contexto. Funciona como
                    <code>.gitignore</code>, indicando qu√© archivos y directorios Claude Code debe ignorar.
                </p>

                <h3>Creaci√≥n de .claudeignore</h3>

                <div class="code-block">
                    <pre><code class="language-bash"># Crear .claudeignore en la ra√≠z del proyecto
cd /ruta/a/tu/proyecto
touch .claudeignore

# Editar con tu editor favorito
nano .claudeignore</code></pre>
                </div>

                <h3>Ejemplo de .claudeignore</h3>

                <div class="code-block">
                    <pre><code class="language-plaintext"># Dependencias y m√≥dulos
node_modules/
vendor/
.venv/
venv/
__pycache__/
*.pyc

# Archivos de compilaci√≥n
dist/
build/
*.min.js
*.min.css
*.bundle.js

# Archivos grandes
*.log
*.pdf
*.zip
*.tar.gz
*.jpg
*.png
*.gif
*.mp4

# Archivos de configuraci√≥n sensibles
.env
.env.local
secrets.json
credentials.json
*.pem
*.key

# Cache y temporales
.cache/
.tmp/
tmp/
.DS_Store
thumbs.db

# IDEs
.vscode/
.idea/
*.swp
*.swo

# Documentaci√≥n generada
docs/api/
coverage/
.nyc_output/

# Base de datos
*.sqlite
*.db
migrations/</code></pre>
                </div>

                <div class="alert tip">
                    <div class="alert-icon">üí°</div>
                    <div class="alert-content">
                        <h4>Mejores Pr√°cticas para .claudeignore</h4>
                        <p>Ignora todo lo que no sea c√≥digo fuente o documentaci√≥n esencial. Esto incluye dependencias,
                        archivos compilados, assets grandes y archivos sensibles. Un buen .claudeignore puede reducir
                        el uso de tokens en un 70-90%.</p>
                    </div>
                </div>

                <h3>Patrones Comunes por Tecnolog√≠a</h3>

                <h4>Node.js / JavaScript</h4>
                <div class="code-block">
                    <pre><code class="language-plaintext">node_modules/
package-lock.json
yarn.lock
dist/
build/
.next/
.nuxt/
coverage/</code></pre>
                </div>

                <h4>Python</h4>
                <div class="code-block">
                    <pre><code class="language-plaintext">__pycache__/
*.pyc
.venv/
venv/
env/
.pytest_cache/
*.egg-info/
dist/
build/</code></pre>
                </div>

                <h4>Ruby / Rails</h4>
                <div class="code-block">
                    <pre><code class="language-plaintext">vendor/bundle/
.bundle/
tmp/
log/
public/assets/
.byebug_history</code></pre>
                </div>

                <h2>Gesti√≥n de Sesiones</h2>

                <p>
                    Claude Code mantiene sesiones de conversaci√≥n que puedes guardar, cargar y gestionar para mantener
                    continuidad en tu trabajo.
                </p>

                <h3>Comandos de Sesi√≥n</h3>

                <div class="code-block">
                    <pre><code class="language-bash"># Ver sesiones guardadas
claude-code sessions list

# Guardar sesi√≥n actual
claude-code sessions save "nombre-de-sesion"

# Cargar sesi√≥n anterior
claude-code sessions load "nombre-de-sesion"

# Continuar √∫ltima sesi√≥n
claude-code sessions resume

# Eliminar sesi√≥n
claude-code sessions delete "nombre-de-sesion"

# Limpiar todas las sesiones
claude-code sessions clear</code></pre>
                </div>

                <h3>Estructura de Sesiones</h3>

                <p>Las sesiones se guardan en <code>~/.config/claude-code/sessions/</code>:</p>

                <div class="code-block">
                    <pre><code class="language-bash"># Ver sesiones guardadas
ls -lh ~/.config/claude-code/sessions/

# Ver contenido de una sesi√≥n
cat ~/.config/claude-code/sessions/mi-sesion.json</code></pre>
                </div>

                <h3>Ejemplo de Workflow con Sesiones</h3>

                <div class="code-block">
                    <pre><code class="language-bash"># Iniciar trabajo en una feature
cd ~/proyecto/feature-auth
claude-code

# Durante la conversaci√≥n...
# Guardar progreso antes de cerrar
> /save auth-implementation

# M√°s tarde, continuar donde lo dejaste
claude-code sessions load "auth-implementation"</code></pre>
                </div>

                <h2>Cache de Contexto</h2>

                <p>
                    Claude Code implementa un sistema de cache inteligente que reduce costos al reutilizar contexto
                    que ya ha sido procesado.
                </p>

                <h3>¬øC√≥mo Funciona el Cache?</h3>

                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üíæ</div>
                        <h3>Cache de Archivos</h3>
                        <p>Archivos frecuentemente accedidos se cachean localmente para evitar lecturas repetidas.</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">üîÑ</div>
                        <h3>Cache de Prompts</h3>
                        <p>Prompts del sistema y configuraci√≥n se reutilizan entre sesiones para reducir tokens.</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">‚ö°</div>
                        <h3>Cache de Respuestas</h3>
                        <p>Respuestas comunes se cachean temporalmente para consultas repetidas.</p>
                    </div>
                </div>

                <h3>Configuraci√≥n de Cache</h3>

                <div class="code-block">
                    <pre><code class="language-bash"># Ver configuraci√≥n de cache
claude-code config show cache

# Habilitar cache (habilitado por defecto)
claude-code config set cache.enabled true

# Configurar TTL (tiempo de vida en segundos)
claude-code config set cache.ttl 3600

# Configurar tama√±o m√°ximo
claude-code config set cache.maxSize "500MB"

# Limpiar cache
claude-code cache clear</code></pre>
                </div>

                <h3>Configuraci√≥n en config.json</h3>

                <div class="code-block">
                    <pre><code class="language-json">{
  "cache": {
    "enabled": true,
    "ttl": 3600,
    "maxSize": "500MB",
    "strategy": "lru",
    "compression": true,
    "paths": {
      "files": "~/.config/claude-code/cache/files",
      "responses": "~/.config/claude-code/cache/responses"
    }
  }
}</code></pre>
                </div>

                <h2>Optimizaci√≥n de Contexto</h2>

                <p>
                    Optimizar el uso de contexto es crucial para reducir costos y mejorar el rendimiento.
                    Aqu√≠ te mostramos las mejores estrategias.
                </p>

                <h3>Estrategia 1: Contexto Incremental</h3>

                <p>
                    En lugar de enviar todo el proyecto cada vez, env√≠a solo lo necesario:
                </p>

                <div class="code-block">
                    <pre><code class="language-bash"># ‚ùå MAL - Env√≠a todo el proyecto
claude-code "Explica la arquitectura" .

# ‚úÖ BIEN - Env√≠a solo archivos relevantes
claude-code "Explica la arquitectura" src/core/*.ts README.md</code></pre>
                </div>

                <h3>Estrategia 2: Resumen de Contexto</h3>

                <p>
                    Para conversaciones largas, usa res√∫menes peri√≥dicos:
                </p>

                <div class="code-block">
                    <pre><code class="language-bash"># Generar resumen de la conversaci√≥n
claude-code --summarize

# Iniciar nueva sesi√≥n con el resumen
claude-code sessions save-summary "proyecto-auth"</code></pre>
                </div>

                <h3>Estrategia 3: Dividir Tareas Grandes</h3>

                <p>
                    Divide proyectos grandes en sesiones enfocadas:
                </p>

                <div class="code-block">
                    <pre><code class="language-bash"># Sesi√≥n 1: Arquitectura
claude-code "Dise√±a la arquitectura del m√≥dulo de auth"
claude-code sessions save "auth-architecture"

# Sesi√≥n 2: Implementaci√≥n
claude-code sessions new
claude-code "Implementa el login bas√°ndote en docs/auth-design.md"
claude-code sessions save "auth-implementation"

# Sesi√≥n 3: Tests
claude-code sessions new
claude-code "Genera tests para src/auth/*.ts"
claude-code sessions save "auth-tests"</code></pre>
                </div>

                <h3>Estrategia 4: Usar Archivos de Contexto</h3>

                <p>
                    Crea archivos de contexto reutilizables:
                </p>

                <div class="code-block">
                    <pre><code class="language-bash"># Crear archivo de contexto
cat > .claude/context.md << 'EOF'
# Contexto del Proyecto

## Stack
- Node.js 20
- TypeScript 5
- Express
- PostgreSQL

## Convenciones
- Usar async/await, no callbacks
- Tests con Jest
- ESLint + Prettier

## Estructura
src/
  controllers/
  services/
  models/
EOF

# Usar en prompts
claude-code "Bas√°ndote en .claude/context.md, crea un nuevo controller"</code></pre>
                </div>

                <h2>Monitoreo de Uso de Contexto</h2>

                <p>
                    Claude Code ofrece herramientas para monitorear tu uso de contexto y costos:
                </p>

                <div class="code-block">
                    <pre><code class="language-bash"># Ver estad√≠sticas de la sesi√≥n actual
claude-code --stats

# Ver historial de uso
claude-code usage stats

# Ver uso por d√≠a
claude-code usage daily

# Ver uso por proyecto
claude-code usage by-project

# Ver estimaci√≥n de costos
claude-code usage costs --month 2025-10</code></pre>
                </div>

                <h3>Interpretaci√≥n de Estad√≠sticas</h3>

                <div class="code-block">
                    <pre><code class="language-plaintext">Session Statistics:
------------------
Total tokens used: 15,420
  - Input tokens:  12,300 (79.8%)
  - Output tokens:  3,120 (20.2%)

Files read: 8
Cache hits: 5 (62.5%)
Estimated cost: $0.18

Context utilization: 15,420 / 200,000 (7.7%)</code></pre>
                </div>

                <h2>Mejores Pr√°cticas de Gesti√≥n de Contexto</h2>

                <div class="alert success">
                    <div class="alert-icon">‚úÖ</div>
                    <div class="alert-content">
                        <h4>Checklist de Optimizaci√≥n</h4>
                        <ul>
                            <li>‚úì Mantener un <code>.claudeignore</code> actualizado</li>
                            <li>‚úì Dividir conversaciones largas en sesiones tem√°ticas</li>
                            <li>‚úì Usar cache cuando sea posible</li>
                            <li>‚úì Enviar solo archivos relevantes, no todo el proyecto</li>
                            <li>‚úì Generar res√∫menes de conversaciones largas</li>
                            <li>‚úì Monitorear uso y costos regularmente</li>
                            <li>‚úì Limpiar sesiones antiguas peri√≥dicamente</li>
                        </ul>
                    </div>
                </div>

                <h3>Ejemplo de Workflow Optimizado</h3>

                <div class="code-block">
                    <pre><code class="language-bash"># 1. Configurar .claudeignore
cat > .claudeignore << 'EOF'
node_modules/
dist/
*.log
.env
EOF

# 2. Iniciar sesi√≥n espec√≠fica
claude-code sessions new

# 3. Enviar solo contexto necesario
claude-code "Refactoriza el m√≥dulo de autenticaci√≥n" \
  src/auth/*.ts \
  docs/auth-design.md

# 4. Guardar progreso
claude-code sessions save "auth-refactor-$(date +%Y%m%d)"

# 5. Verificar uso
claude-code --stats</code></pre>
                </div>

                <h2>Troubleshooting de Contexto</h2>

                <h3>Problema: "Context window exceeded"</h3>

                <div class="code-block">
                    <pre><code class="language-bash"># Verificar tama√±o del contexto
claude-code --stats

# Soluciones:
# 1. Dividir en sesiones m√°s peque√±as
claude-code sessions save "parte-1"
claude-code sessions new

# 2. Mejorar .claudeignore
echo "carpeta-grande/" >> .claudeignore

# 3. Usar modelo con mayor ventana
claude-code --model opus "Tu tarea aqu√≠"</code></pre>
                </div>

                <h3>Problema: Costos Altos</h3>

                <div class="code-block">
                    <pre><code class="language-bash"># Analizar uso
claude-code usage costs --detailed

# Optimizar:
# 1. Usar Haiku para tareas simples
claude-code --model haiku "Formatea este c√≥digo"

# 2. Habilitar cache agresivo
claude-code config set cache.ttl 7200

# 3. Limpiar contexto innecesario
claude-code sessions clear-old --days 30</code></pre>
                </div>

                <div class="alert tip">
                    <div class="alert-icon">üí°</div>
                    <div class="alert-content">
                        <h4>Consejo Pro</h4>
                        <p>Para proyectos grandes, crea un script de inicializaci√≥n que configure autom√°ticamente
                        .claudeignore, archivos de contexto y sesiones. Esto asegura consistencia y optimizaci√≥n
                        desde el inicio.</p>
                    </div>
                </div>

                <nav class="navigation">
                    <a href="03-comandos.html" class="nav-btn">
                        ‚Üê Anterior: Comandos B√°sicos
                    </a>
                    <a href="05-mcp.html" class="nav-btn">
                        Siguiente: Model Context Protocol ‚Üí
                    </a>
                </nav>
            </div>
        </div>
    </main>

    <footer>
        <div class="container footer-content">
            <p>&copy; 2025 Claude Code Documentation. Creado con Claude Code.</p>
            <div class="footer-links">
                <a href="https://www.anthropic.com" target="_blank">Anthropic</a>
                <a href="https://docs.anthropic.com" target="_blank">Documentaci√≥n Oficial</a>
                <a href="https://github.com/anthropics/claude-code" target="_blank">GitHub</a>
            </div>
        </div>
    </footer>

    <script src="assets/js/navigation.js"></script>
    <script src="assets/js/code-copy.js"></script>
</body>
</html>
